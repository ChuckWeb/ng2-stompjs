!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/BehaviorSubject"),require("rxjs/Observable"),require("rxjs/Subject"),require("rxjs/add/operator/filter"),require("rxjs/add/operator/share"),require("@stomp/stompjs/index")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/BehaviorSubject","rxjs/Observable","rxjs/Subject","rxjs/add/operator/filter","rxjs/add/operator/share","@stomp/stompjs/index"],t):t(e["ng2-stompjs"]={},e.ng.core,e.Rx,e.Rx,e.Rx,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e[""]["/node_modules/@stomp/stompjs/index"].js)}(this,function(e,t,n,o,i,r,s,c){"use strict";var u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a={};a.CLOSED=0,a.TRYING=1,a.CONNECTED=2,a.DISCONNECTING=3,a[a.CLOSED]="CLOSED",a[a.TRYING]="TRYING",a[a.CONNECTED]="CONNECTED",a[a.DISCONNECTING]="DISCONNECTING";var h=function(){function e(){var e=this;this.queuedMessages=[],this.debug=function(e){console.log(new Date,e)},this.on_connect=function(){e.debug("Connected"),e.state.next(a.CONNECTED)},this.on_error=function(t){e.errorSubject.next(t),"object"==typeof t&&(t=t.body),e.debug("Error: "+t),e.client.connected||e.state.next(a.CLOSED)},this.state=new n.BehaviorSubject(a.CLOSED),this.connectObservable=this.state.filter(function(e){return e===a.CONNECTED}),this.connectObservable.subscribe(function(){e.sendQueuedMessages()}),this.errorSubject=new i.Subject}return Object.defineProperty(e.prototype,"config",{set:function(e){this._config=e},enumerable:!0,configurable:!0}),e.prototype.initStompClient=function(){this.disconnect(),"string"==typeof this._config.url?this.client=c.client(this._config.url):this.client=c.over(this._config.url),this.client.heartbeat.incoming=this._config.heartbeat_in,this.client.heartbeat.outgoing=this._config.heartbeat_out,this.client.reconnect_delay=this._config.reconnect_delay,this._config.debug||(this.debug=function(){}),this.client.debug=this.debug},e.prototype.initAndConnect=function(){this.initStompClient(),this._config.headers||(this._config.headers={}),this.client.connect(this._config.headers,this.on_connect,this.on_error),this.debug("Connecting..."),this.state.next(a.TRYING)},e.prototype.disconnect=function(){var e=this;this.client&&this.client.connected&&(this.state.next(a.DISCONNECTING),this.client.disconnect(function(){return e.state.next(a.CLOSED)}))},e.prototype.connected=function(){return this.state.getValue()===a.CONNECTED},e.prototype.publish=function(e,t,n){void 0===n&&(n={}),this.connected()?this.client.send(e,n,t):(this.debug("Not connected, queueing "+t),this.queuedMessages.push({queueName:e,message:t,headers:n}))},e.prototype.sendQueuedMessages=function(){var e=this.queuedMessages;this.queuedMessages=[],this.debug("Will try sending queued messages "+e);for(var t=0,n=e;t<n.length;t++){var o=n[t];this.debug("Attempting to send "+o),this.publish(o.queueName,o.message,o.headers)}},e.prototype.subscribe=function(e,t){var n=this;void 0===t&&(t={}),this.debug("Request to subscribe "+e),t.ack||(t.ack="auto");return o.Observable.create(function(o){var i,r;return r=n.connectObservable.subscribe(function(){n.debug("Will subscribe to "+e),i=n.client.subscribe(e,function(e){o.next(e)},t)}),function(){n.debug("Stop watching connection state (for "+e+")"),r.unsubscribe(),n.state.getValue()===a.CONNECTED?(n.debug("Will unsubscribe from "+e+" at Stomp"),i.unsubscribe()):n.debug("Stomp not connected, no need to unsubscribe from "+e+" at Stomp")}}).share()},e}();h.decorators=[{type:t.Injectable}],h.ctorParameters=function(){return[]};var b=function(){return function(){}}();b.decorators=[{type:t.Injectable}],b.ctorParameters=function(){return[]};var d=function(e){function t(t){var n=e.call(this)||this;return n.config=t,n.initAndConnect(),n}return u(t,e),t}(h);d.decorators=[{type:t.Injectable}],d.ctorParameters=function(){return[{type:b}]},e.StompRService=h,e.StompService=d,e.StompState=a,e.StompConfig=b,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ng2-stompjs.umd.min.js.map
