!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/BehaviorSubject"),require("rxjs/Observable"),require("rxjs/Subject"),require("rxjs/add/operator/filter"),require("rxjs/add/operator/first"),require("rxjs/add/operator/share"),require("@stomp/stompjs")):"function"==typeof define&&define.amd?define("@stomp/ng2-stompjs",["exports","@angular/core","rxjs/BehaviorSubject","rxjs/Observable","rxjs/Subject","rxjs/add/operator/filter","rxjs/add/operator/first","rxjs/add/operator/share","@stomp/stompjs"],t):t((e.stomp=e.stomp||{},e.stomp["ng2-stompjs"]={}),e.ng.core,e.Rx,e.Rx,e.Rx,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.stompjs)}(this,function(e,t,n,s,r,i,o,c,u){"use strict";var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};var b={CLOSED:0,TRYING:1,CONNECTED:2,DISCONNECTING:3};b[b.CLOSED]="CLOSED",b[b.TRYING]="TRYING",b[b.CONNECTED]="CONNECTED",b[b.DISCONNECTING]="DISCONNECTING";var h=function(){function e(){var t=this;this.queuedMessages=[],this.debug=function(e){console.log(new Date,e)},this.on_connect=function(e){t.debug("Connected"),t._serverHeadersBehaviourSubject.next(e.headers),t.state.next(b.CONNECTED)},this.on_error=function(e){t.errorSubject.next(e),"object"==typeof e&&(e=e.body),t.debug("Error: "+e),t.client.connected||t.state.next(b.CLOSED)},this.state=new n.BehaviorSubject(b.CLOSED),this.connectObservable=this.state.filter(function(e){return e===b.CONNECTED}),this.connectObservable.subscribe(function(){t.sendQueuedMessages()}),this._serverHeadersBehaviourSubject=new n.BehaviorSubject(null),this.serverHeadersObservable=this._serverHeadersBehaviourSubject.filter(function(e){return null!==e}),this.errorSubject=new r.Subject}return Object.defineProperty(e.prototype,"config",{set:function(e){this._config=e},enumerable:!0,configurable:!0}),e.prototype.initStompClient=function(){this.disconnect(),"string"==typeof this._config.url?this.client=u.client(this._config.url):this.client=u.over(this._config.url),this.client.heartbeat.incoming=this._config.heartbeat_in,this.client.heartbeat.outgoing=this._config.heartbeat_out,this.client.reconnect_delay=this._config.reconnect_delay,this._config.debug||(this.debug=function(){}),this.client.debug=this.debug,this.setupOnReceive(),this.setupReceipts()},e.prototype.initAndConnect=function(){this.initStompClient(),this._config.headers||(this._config.headers={}),this.client.connect(this._config.headers,this.on_connect,this.on_error),this.debug("Connecting..."),this.state.next(b.TRYING)},e.prototype.disconnect=function(){var e=this;this.client&&this.client.connected&&(this.state.next(b.DISCONNECTING),this.client.disconnect(function(){return e.state.next(b.CLOSED)}))},e.prototype.connected=function(){return this.state.getValue()===b.CONNECTED},e.prototype.publish=function(e,t,n){void 0===n&&(n={}),this.connected()?this.client.send(e,n,t):(this.debug("Not connected, queueing "+t),this.queuedMessages.push({queueName:e,message:t,headers:n}))},e.prototype.sendQueuedMessages=function(){var e,t,n=this.queuedMessages;this.queuedMessages=[],this.debug("Will try sending queued messages "+n);try{for(var r=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(n),i=r.next();!i.done;i=r.next()){var o=i.value;this.debug("Attempting to send "+o),this.publish(o.queueName,o.message,o.headers)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.subscribe=function(r,i){var o=this;return void 0===i&&(i={}),this.debug("Request to subscribe "+r),i.ack||(i.ack="auto"),s.Observable.create(function(t){var e,n;return n=o.connectObservable.subscribe(function(){o.debug("Will subscribe to "+r),e=o.client.subscribe(r,function(e){t.next(e)},i)}),function(){o.debug("Stop watching connection state (for "+r+")"),n.unsubscribe(),o.state.getValue()===b.CONNECTED?(o.debug("Will unsubscribe from "+r+" at Stomp"),e.unsubscribe()):o.debug("Stomp not connected, no need to unsubscribe from "+r+" at Stomp")}}).share()},e.prototype.setupOnReceive=function(){var t=this;this.defaultMessagesObservable=new r.Subject,this.client.onreceive=function(e){t.defaultMessagesObservable.next(e)}},e.prototype.setupReceipts=function(){var t=this;this.receiptsObservable=new r.Subject,this.client.onreceipt=function(e){t.receiptsObservable.next(e)}},e.prototype.waitForReceipt=function(t,n){this.receiptsObservable.filter(function(e){return e.headers["receipt-id"]===t}).first().subscribe(function(e){n(e)})},e}();h.decorators=[{type:t.Injectable}],h.ctorParameters=function(){return[]};var p=function(){};p.decorators=[{type:t.Injectable}];var f=function(n){function e(e){var t=n.call(this)||this;return t.config=e,t.initAndConnect(),t}return function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(e,n),e}(h);f.decorators=[{type:t.Injectable}],f.ctorParameters=function(){return[{type:p}]},e.StompRService=h,e.StompService=f,e.StompState=b,e.StompConfig=p,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=stomp-ng2-stompjs.umd.min.js.map
